<div class="container-fluid" id="addClinicsContainer">
	<div class="wrapper d-none">
		<h1 class="title-medium"><%= UI_DISPLAY_LANG.views.pages.add_clinics.sectionTitle %></h1>
	</div>
	<div class="mt-3 app-block" id="wrapper01">
		<div class="alert alert-info my-2" style="display:none;" id="ERROR_BOX">
			<img src="assets/img/utils/info.png" class="alert-icon" alt="">
			<div class="alert-text" id="text"></div>
		</div>
		<form action="#" id="addForm">
			<div class="row gx-4 gy-4">
				<div class="col-lg-12 col-md-12 col-sm-12">
					<div class="">
						<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.add_clinics.form01.label01 %></label>
						<input type="text" class="input-text input-text-outline" id="nameInput">
					</div>	
				</div>
				<div class="col-lg-12 col-md-12 col-sm-12">
					<div class="">
						<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.add_clinics.form01.label02 %></label>
						<input type="text" class="input-text input-text-outline" id="phoneInput">
					</div>	
				</div>
				<div class="col-lg-12 col-md-12 col-sm-12">
					<div class="section">
						<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.add_clinics.form01.label04 %></label>
						<select name="" class="input-text" id="wilayaSelect">
							
						</select>
					</div>	
				</div>
				<div class="col-lg-12 col-md-12 col-sm-12">
					<div class="">
						<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.add_clinics.form01.label05 %></label>
						<input type="text" class="input-text input-text-outline" id="baladiaInput">
					</div>	
				</div>
				<div class="col-lg-12 col-md-12 col-sm-12">
					<div class="">
						<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.add_clinics.form01.label06 %></label>
						<input type="text" class="input-text input-text-outline" id="addressInput">
					</div>	
				</div>
				<div class="col-lg-12 col-md-12 col-sm-12">
					<div class="">
						<label for="" class="form-label"><%= UI_DISPLAY_LANG.views.pages.global.label8 %></label>
						<input type="email" class="input-text input-text-outline" id="emailInput">
					</div>	
				</div>
			</div>
			<div class="mt-3">
				<input type="submit" class="btn btn-primary btn-sm shadow" value="<%= UI_DISPLAY_LANG.views.pages.add_clinics.form01.submitBTN01 %>">
			</div>
		</form>
	</div>
</div>


<script>

$(async function()
{

var addClinicsContainer = $('#addClinicsContainer');
if ( addClinicsContainer[0] == undefined ) return;

var ERROR_BOX = addClinicsContainer.find('#ERROR_BOX');

var addForm = addClinicsContainer.find('#addForm');
var nameInput = addForm.find('#nameInput');
var phoneInput = addForm.find('#phoneInput');
var wilayaSelect = addForm.find('#wilayaSelect');
var baladiaInput = addForm.find('#baladiaInput');
var addressInput = addForm.find('#addressInput');
var emailInput = addForm.find('#emailInput');

var wrapper01 = addClinicsContainer.find('#wrapper01');

var ClinicObject = {
	clinicId: sessionData(true).clinicId
};
// addForm submit
addForm.off('submit');
addForm.on('submit', e =>
{
	e.preventDefault();
	var target = addForm;
	ClinicObject.clinicName = nameInput.val();
	ClinicObject.clinicPhone  = phoneInput.val();
	ClinicObject.clinicState  = wilayaSelect.find(':selected').val();
	ClinicObject.clinicBaladia = baladiaInput.val();
	ClinicObject.clinicAddress = addressInput.val();
	ClinicObject.clinicEmail = emailInput.val();
	// display loader
	SectionLoader(wrapper01);
	// update
	if ( ClinicObject.clinicId != null )
	{
		CLINIC_MODEL.update(ClinicObject).then(response =>
		{
			// hide loader
			SectionLoader(wrapper01, '');
			if ( response.code == 404 )
			{
				ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(response.message);
				return;
			}
			ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(response.message);
			//
			target[0].reset();
			ClinicObject.clinicId = null;
		});
		return;	
	}
	// add
	CLINIC_MODEL.store(ClinicObject).then(response =>
	{
		// hide loader
		SectionLoader(wrapper01, '');
		if ( response.code == 404 )
		{
			ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(response.message);
			return;
		}
		ERROR_BOX.show(0).delay(7*1000).hide(0).find('#text').text(response.message);
		//
		target[0].reset();
	});
});
// list states
// display loader
SectionLoader(wilayaSelect.closest('.section'));
var response = await getAllStates();
// hide loader
SectionLoader(wilayaSelect.closest('.section'), '');
if ( response.code == 200 )
{
	var data = response.data;
	var html = '';
	$.each(data, (k,v) =>
	{
		html += `<option value="${v.wilaya_name}">${v.wilaya_name}</option>`;
	});
	// add html
	wilayaSelect.html(html);
	setOptionSelected(wilayaSelect, USER_CONFIG.managerState );
}
//
displayOne();
async function displayOne()
{
	if ( ClinicObject.clinicId == null )
		return;

	// display loader
	SectionLoader(wrapper01);
	var response = await CLINIC_MODEL.show(ClinicObject.clinicId);
	// hide loader
	SectionLoader(wrapper01, '');
	if ( response.code == 404 )
		return;

	var data = response.data;
	nameInput.val( data.clinicName );
	phoneInput.val( data.clinicPhone );
	setOptionSelected(wilayaSelect, data.clinicState );
	baladiaInput.val( data.clinicBaladia );
	addressInput.val( data.clinicAddress );
	emailInput.val( data.clinicEmail );
}

})

</script>